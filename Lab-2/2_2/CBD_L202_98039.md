# CBD – Lab202 – 98039

<!-- 1. Liste todos os documentos da coleção. -->
db.restaurants.find( {} )
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786206"), "address" : { "building" : "97-22", "coord" : [ -73.8601152, 40.7311739 ], "rua" : "63 Road", "zipcode" : "11374" }, "localidade" : "Queens", "gastronomia" : "Jewish/Kosher", "grades" : [ { "date" : ISODate("2014-11-24T00:00:00Z"), "grade" : "Z", "score" : 20 }, { "date" : ISODate("2013-01-17T00:00:00Z"), "grade" : "A", "score" : 13 }, { "date" : ISODate("2012-08-02T00:00:00Z"), "grade" : "A", "score" : 13 }, { "date" : ISODate("2011-12-15T00:00:00Z"), "grade" : "B", "score" : 25 } ], "nome" : "Tov Kosher Kitchen", "restaurant_id" : "40356068" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786207"), "address" : { "building" : "2780", "coord" : [ -73.98241999999999, 40.579505 ], "rua" : "Stillwell Avenue", "zipcode" : "11224" }, "localidade" : "Brooklyn", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-06-10T00:00:00Z"), "grade" : "A", "score" : 5 }, { "date" : ISODate("2013-06-05T00:00:00Z"), "grade" : "A", "score" : 7 }, { "date" : ISODate("2012-04-13T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2011-10-12T00:00:00Z"), "grade" : "A", "score" : 12 } ], "nome" : "Riviera Caterer", "restaurant_id" : "40356018" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786208"), "address" : { "building" : "2206", "coord" : [ -74.1377286, 40.6119572 ], "rua" : "Victory Boulevard", "zipcode" : "10314" }, "localidade" : "Staten Island", "gastronomia" : "Jewish/Kosher", "grades" : [ { "date" : ISODate("2014-10-06T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2014-05-20T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2013-04-04T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2012-01-24T00:00:00Z"), "grade" : "A", "score" : 9 } ], "nome" : "Kosher Island", "restaurant_id" : "40356442" } -->


<!-- 2. Apresente os campos restaurant_id, nome, localidade e gastronomia para todos os
documentos da coleção. -->
db.restaurants.find( {}, { restaurant_id: 1, nome: 1, localidade: 1, gastronomia: 1 } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786206"), "localidade" : "Queens", "gastronomia" : "Jewish/Kosher", "nome" : "Tov Kosher Kitchen", "restaurant_id" : "40356068" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786207"), "localidade" : "Brooklyn", "gastronomia" : "American", "nome" : "Riviera Caterer", "restaurant_id" : "40356018" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786208"), "localidade" : "Staten Island", "gastronomia" : "Jewish/Kosher", "nome" : "Kosher Island", "restaurant_id" : "40356442" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786209"), "localidade" : "Brooklyn", "gastronomia" : "Delicatessen", "nome" : "Wilken'S Fine Food", "restaurant_id" : "40356483" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620a"), "localidade" : "Brooklyn", "gastronomia" : "Ice Cream, Gelato, Yogurt, Ices", "nome" : "Taste The Tropics Ice Cream", "restaurant_id" : "40356731" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620b"), "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Wild Asia", "restaurant_id" : "40357217" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620c"), "localidade" : "Brooklyn", "gastronomia" : "American", "nome" : "C & C Catering Service", "restaurant_id" : "40357437" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620d"), "localidade" : "Brooklyn", "gastronomia" : "American", "nome" : "Regina Caterers", "restaurant_id" : "40356649" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620e"), "localidade" : "Brooklyn", "gastronomia" : "Chinese", "nome" : "May May Kitchen", "restaurant_id" : "40358429" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620f"), "localidade" : "Bronx", "gastronomia" : "Bakery", "nome" : "Morris Park Bake Shop", "restaurant_id" : "30075445" }
-->

<!-- 3. Apresente os campos restaurant_id, nome, localidade e código postal (zipcode), mas
exclua o campo _id de todos os documentos da coleção. -->
db.restaurants.find( {}, { _id: 0, restaurant_id: 1, nome: 1, localidade: 1, address: { zipcode: 1 } } )
<!-- { "address" : { "zipcode" : "11374" }, "localidade" : "Queens", "nome" : "Tov Kosher Kitchen", "restaurant_id" : "40356068" }
{ "address" : { "zipcode" : "11224" }, "localidade" : "Brooklyn", "nome" : "Riviera Caterer", "restaurant_id" : "40356018" }
{ "address" : { "zipcode" : "10314" }, "localidade" : "Staten Island", "nome" : "Kosher Island", "restaurant_id" : "40356442" }
{ "address" : { "zipcode" : "11234" }, "localidade" : "Brooklyn", "nome" : "Wilken'S Fine Food", "restaurant_id" : "40356483" }
{ "address" : { "zipcode" : "11226" }, "localidade" : "Brooklyn", "nome" : "Taste The Tropics Ice Cream", "restaurant_id" : "40356731" }
{ "address" : { "zipcode" : "10460" }, "localidade" : "Bronx", "nome" : "Wild Asia", "restaurant_id" : "40357217" }
{ "address" : { "zipcode" : "11214" }, "localidade" : "Brooklyn", "nome" : "C & C Catering Service", "restaurant_id" : "40357437" }
{ "address" : { "zipcode" : "11219" }, "localidade" : "Brooklyn", "nome" : "Regina Caterers", "restaurant_id" : "40356649" } -->

<!-- 4. Indique o total de restaurantes localizados no Bronx. -->
db.restaurants.count( { localidade: "Bronx" } )
<!-- 309 -->

<!-- 5. Apresente os primeiros 15 restaurantes localizados no Bronx, ordenados por
ordem crescente de nome. -->
db.restaurants.find( { localidade: "Bronx" } ).sort( { nome: 1 } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb92797862e2"), "address" : { "building" : "2300", "coord" : [ -73.8786113, 40.8502883 ], "rua" : "Southern Boulevard", "zipcode" : "10460" }, "localidade" : "Bronx", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-05-21T00:00:00Z"), "grade" : "A", "score" : 5 }, { "date" : ISODate("2013-05-28T00:00:00Z"), "grade" : "A", "score" : 3 }, { "date" : ISODate("2012-06-18T00:00:00Z"), "grade" : "A", "score" : 4 }, { "date" : ISODate("2011-06-07T00:00:00Z"), "grade" : "A", "score" : 9 } ], "nome" : "African Market (Baboon Cafe)", "restaurant_id" : "40368026" }
{ "_id" : ObjectId("617a6daa7f1fdb92797862dc"), "address" : { "building" : "2300", "coord" : [ -73.8786113, 40.8502883 ], "rua" : "Southern Boulevard", "zipcode" : "10460" }, "localidade" : "Bronx", "gastronomia" : "African", "grades" : [ { "date" : ISODate("2014-05-21T00:00:00Z"), "grade" : "A", "score" : 8 }, { "date" : ISODate("2013-06-01T00:00:00Z"), "grade" : "A", "score" : 6 }, { "date" : ISODate("2012-06-12T00:00:00Z"), "grade" : "A", "score" : 0 }, { "date" : ISODate("2011-06-08T00:00:00Z"), "grade" : "A", "score" : 0 } ], "nome" : "African Terrace", "restaurant_id" : "40368021" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786778"), "address" : grad{ "building" : "3825", "coord" : [ -73.86267, 40.884484 ], "rua" : "White Plains Road", "zipcode" : "10467" }, "localidade" : "Bronx", "gastronomia" : "Caribbean", "grades" : [ { "date" : ISODate("2014-11-06T00:00:00Z"), "grade" : "Z", "score" : 20 }, { "date" : ISODate("2014-06-16T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2013-10-21T00:00:00Z"), "grade" : "B", "score" : 15 }, { "date" : ISODate("2013-05-20T00:00:00Z"), "grade" : "B", "score" : 22 }, { "date" : ISODate("2012-04-17T00:00:00Z"), "grade" : "A", "score" : 10 } ], "nome" : "Al Cholo Bakery", "restaurant_id" : "40424273" }
-->

<!-- Verificar se ordem está correta -->
db.restaurants.find( { localidade: "Bronx" }, { nome : 1} ).sort( { nome: 1 } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb92797862e2"), "nome" : "African Market (Baboon Cafe)" }
{ "_id" : ObjectId("617a6daa7f1fdb92797862dc"), "nome" : "African Terrace" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786778"), "nome" : "Al Cholo Bakery" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786d4a"), "nome" : "Ali'S Roti Shop" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786759"), "nome" : "Ambassador Diner" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786971"), "nome" : "An Beal Bocht Cafe" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786d0f"), "nome" : "Angelica'S Bakery" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786dba"), "nome" : "Applebee'S Neighborhood Grill & Bar" }
{ "_id" : ObjectId("617a6daa7f1fdb92797863ec"), "nome" : "Aqueduct North" }
-->

<!-- 6. Liste todos os restaurantes que tenham pelo menos um score superior a 85. -->
db.restaurants.find( { "grades.score": { $gt: 85 } } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786364"), "address" : { "building" : "65", "coord" : [ -73.9782725, 40.7624022 ], "rua" : "West   54 Street", "zipcode" : "10019" }, "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-08-22T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2014-03-28T00:00:00Z"), "grade" : "C", "score" : 131 }, { "date" : ISODate("2013-09-25T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2013-04-08T00:00:00Z"), "grade" : "B", "score" : 25 }, { "date" : ISODate("2012-10-15T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2011-10-19T00:00:00Z"), "grade" : "A", "score" : 13 } ], "nome" : "Murals On 54/Randolphs'S", "restaurant_id" : "40372466" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786406"), "address" : { "building" : "345", "coord" : [ -73.9864626, 40.7266739 ], "rua" : "East 6 Street", "zipcode" : "10003" }, "localidade" : "Manhattan", "gastronomia" : "Indian", "grades" : [ { "date" : ISODate("2014-09-15T00:00:00Z"), "grade" : "A", "score" : 5 }, { "date" : ISODate("2014-01-14T00:00:00Z"), "grade" : "A", "score" : 8 }, { "date" : ISODate("2013-05-30T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2013-04-24T00:00:00Z"), "grade" : "P", "score" : 2 }, { "date" : ISODate("2012-10-01T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2012-04-06T00:00:00Z"), "grade" : "C", "score" : 92 }, { "date" : ISODate("2011-11-03T00:00:00Z"), "grade" : "C", "score" : 41 } ], "nome" : "Gandhi", "restaurant_id" : "40381295" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786574"), "address" : { "building" : "130", "coord" : [ -73.984758, 40.7457939 ], "rua" : "Madison Avenue", "zipcode" : "10016" }, "localidade" : "Manhattan", "gastronomia" : "Pizza/Italian", "grades" : [ { "date" : ISODate("2014-12-24T00:00:00Z"), "grade" : "Z", "score" : 31 }, { "date" : ISODate("2014-06-17T00:00:00Z"), "grade" : "C", "score" : 98 }, { "date" : ISODate("2013-12-12T00:00:00Z"), "grade" : "C", "score" : 32 }, { "date" : ISODate("2013-05-22T00:00:00Z"), "grade" : "B", "score" : 21 }, { "date" : ISODate("2012-05-02T00:00:00Z"), "grade" : "A", "score" : 11 } ], "nome" : "Bella Napoli", "restaurant_id" : "40393488" } -->


<!-- 7. Encontre os restaurantes que obtiveram uma ou mais pontuações (score) entre [80 e 100]. -->
db.restaurants.find( { grades: { $elemMatch: { score: { $gte: 85, $lte: 100 } } } } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786406"), "address" : { "building" : "345", "coord" : [ -73.9864626, 40.7266739 ], "rua" : "East 6 Street", "zipcode" : "10003" }, "localidade" : "Manhattan", "gastronomia" : "Indian", "grades" : [ { "date" : ISODate("2014-09-15T00:00:00Z"), "grade" : "A", "score" : 5 }, { "date" : ISODate("2014-01-14T00:00:00Z"), "grade" : "A", "score" : 8 }, { "date" : ISODate("2013-05-30T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2013-04-24T00:00:00Z"), "grade" : "P", "score" : 2 }, { "date" : ISODate("2012-10-01T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2012-04-06T00:00:00Z"), "grade" : "C", "score" : 92 }, { "date" : ISODate("2011-11-03T00:00:00Z"), "grade" : "C", "score" : 41 } ], "nome" : "Gandhi", "restaurant_id" : "40381295" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786574"), "address" : { "building" : "130", "coord" : [ -73.984758, 40.7457939 ], "rua" : "Madison Avenue", "zipcode" : "10016" }, "localidade" : "Manhattan", "gastronomia" : "Pizza/Italian", "grades" : [ { "date" : ISODate("2014-12-24T00:00:00Z"), "grade" : "Z", "score" : 31 }, { "date" : ISODate("2014-06-17T00:00:00Z"), "grade" : "C", "score" : 98 }, { "date" : ISODate("2013-12-12T00:00:00Z"), "grade" : "C", "score" : 32 }, { "date" : ISODate("2013-05-22T00:00:00Z"), "grade" : "B", "score" : 21 }, { "date" : ISODate("2012-05-02T00:00:00Z"), "grade" : "A", "score" : 11 } ], "nome" : "Bella Napoli", "restaurant_id" : "40393488" }
{ "_id" : ObjectId("617a6dab7f1fdb9279786dd1"), "address" : { "building" : "", "coord" : [ -74.0163793, 40.7167671 ], "rua" : "Hudson River", "zipcode" : "10282" }, "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-06-27T00:00:00Z"), "grade" : "C", "score" : 89 }, { "date" : ISODate("2013-06-06T00:00:00Z"), "grade" : "A", "score" : 6 }, { "date" : ISODate("2012-06-19T00:00:00Z"), "grade" : "A", "score" : 13 } ], "nome" : "West 79Th Street Boat Basin Cafe", "restaurant_id" : "40756344" } -->

<!-- 8. Indique os restaurantes com latitude inferior a -95,7. -->
db.restaurants.find( { "address.coord.0": { $lt: -95.7 } } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb927978684c"), "address" : { "building" : "3707", "coord" : [ -101.8945214, 33.5197474 ], "rua" : "82 Street", "zipcode" : "11372" }, "localidade" : "Queens", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-06-04T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2013-11-07T00:00:00Z"), "grade" : "B", "score" : 19 }, { "date" : ISODate("2013-05-17T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2012-08-29T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2012-04-03T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2011-11-16T00:00:00Z"), "grade" : "A", "score" : 7 } ], "nome" : "Burger King", "restaurant_id" : "40534067" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786bb4"), "address" : { "building" : "15259", "coord" : [ -119.6368672, 36.2504996 ], "rua" : "10 Avenue", "zipcode" : "11357" }, "localidade" : "Queens", "gastronomia" : "Italian", "grades" : [ { "date" : ISODate("2014-09-04T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2014-03-26T00:00:00Z"), "grade" : "A", "score" : 8 }, { "date" : ISODate("2013-03-04T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2012-09-27T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2012-04-20T00:00:00Z"), "grade" : "A", "score" : 7 }, { "date" : ISODate("2011-11-23T00:00:00Z"), "grade" : "C", "score" : 34 } ], "nome" : "Cascarino'S", "restaurant_id" : "40668681" }
{ "_id" : ObjectId("617a6dab7f1fdb927978705d"), "address" : { "building" : "60", "coord" : [ -111.9975205, 42.0970258 ], "rua" : "West Side Highway", "zipcode" : "10006" }, "localidade" : "Manhattan", "gastronomia" : "Japanese", "grades" : [ { "date" : ISODate("2014-03-20T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2013-06-28T00:00:00Z"), "grade" : "A", "score" : 11 }, { "date" : ISODate("2012-07-05T00:00:00Z"), "grade" : "A", "score" : 13 }, { "date" : ISODate("2011-07-27T00:00:00Z"), "grade" : "A", "score" : 2 } ], "nome" : "Sports Center At Chelsea Piers (Sushi Bar)", "restaurant_id" : "40882356" } -->

<!-- 9. Indique os restaurantes que não têm gastronomia "American", tiveram uma (ou mais) pontuação superior a 70 e estão numa latitude inferior a -65. -->
db.restaurants.find( { $and: [ { gastronomia: { $ne: "American" } }, { "grades.score": { $gt: 70 } }, { "address.coord.0": { $lt: -65 } } ] } ) 
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786406"), "address" : { "building" : "345", "coord" : [ -73.9864626, 40.7266739 ], "rua" : "East 6 Street", "zipcode" : "10003" }, "localidade" : "Manhattan", "gastronomia" : "Indian", "grades" : [ { "date" : ISODate("2014-09-15T00:00:00Z"), "grade" : "A", "score" : 5 }, { "date" : ISODate("2014-01-14T00:00:00Z"), "grade" : "A", "score" : 8 }, { "date" : ISODate("2013-05-30T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2013-04-24T00:00:00Z"), "grade" : "P", "score" : 2 }, { "date" : ISODate("2012-10-01T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2012-04-06T00:00:00Z"), "grade" : "C", "score" : 92 }, { "date" : ISODate("2011-11-03T00:00:00Z"), "grade" : "C", "score" : 41 } ], "nome" : "Gandhi", "restaurant_id" : "40381295" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786572"), "address" : { "building" : "101", "coord" : [ -73.9243061, 40.8276297 ], "rua" : "East 161 Street", "zipcode" : "10451" }, "localidade" : "Bronx", "gastronomia" : "Latin (Cuban, Dominican, Puerto Rican, South & Central American)", "grades" : [ { "date" : ISODate("2014-04-10T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2013-10-01T00:00:00Z"), "grade" : "A", "score" : 6 }, { "date" : ISODate("2013-04-11T00:00:00Z"), "grade" : "B", "score" : 25 }, { "date" : ISODate("2012-10-25T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2012-10-10T00:00:00Z"), "grade" : "P", "score" : 12 }, { "date" : ISODate("2012-05-25T00:00:00Z"), "grade" : "B", "score" : 14 }, { "date" : ISODate("2011-09-14T00:00:00Z"), "grade" : "B", "score" : 26 }, { "date" : ISODate("2011-04-25T00:00:00Z"), "grade" : "C", "score" : 76 } ], "nome" : "El Molino Rojo Restaurant", "restaurant_id" : "40393688" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786574"), "address" : { "building" : "130", "coord" : [ -73.984758, 40.7457939 ], "rua" : "Madison Avenue", "zipcode" : "10016" }, "localidade" : "Manhattan", "gastronomia" : "Pizza/Italian", "grades" : [ { "date" : ISODate("2014-12-24T00:00:00Z"), "grade" : "Z", "score" : 31 }, { "date" : ISODate("2014-06-17T00:00:00Z"), "grade" : "C", "score" : 98 }, { "date" : ISODate("2013-12-12T00:00:00Z"), "grade" : "C", "score" : 32 }, { "date" : ISODate("2013-05-22T00:00:00Z"), "grade" : "B", "score" : 21 }, { "date" : ISODate("2012-05-02T00:00:00Z"), "grade" : "A", "score" : 11 } ], "nome" : "Bella Napoli", "restaurant_id" : "40393488" } -->

<!-- 10. Liste o restaurant_id, o nome, a localidade e gastronomia dos restaurantes cujo nome começam por "Wil". -->
db.restaurants.find( { nome: { $regex: /^Wil/ } }, { restaurant_id: 1, nome: 1, localidade: 1, gastronomia: 1 } )
db.restaurants.find( { nome: { $regex: /^Wil.*/ } }, { restaurant_id: 1, nome: 1, localidade: 1, gastronomia: 1 } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786209"), "localidade" : "Brooklyn", "gastronomia" : "Delicatessen", "nome" : "Wilken'S Fine Food", "restaurant_id" : "40356483" }
{ "_id" : ObjectId("617a6daa7f1fdb927978620b"), "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Wild Asia", "restaurant_id" : "40357217" }
{ "_id" : ObjectId("617a6dab7f1fdb9279787014"), "localidade" : "Bronx", "gastronomia" : "Pizza", "nome" : "Wilbel Pizza", "restaurant_id" : "40871979" } -->

<!-- 11. Liste o nome, a localidade e a gastronomia dos restaurantes que pertencem ao Bronx e cuja gastronomia é do tipo "American" ou "Chinese". -->
db.restaurants.find( { $and: [ { localidade: "Bronx" }, { $or: [ { gastronomia: "American" }, { gastronomia: "Chinese" } ] } ] }, { nome: 1, localidade: 1, gastronomia: 1, _id: 0 } )
<!-- { "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Wild Asia" }
{ "localidade" : "Bronx", "gastronomia" : "Chinese", "nome" : "Happy Garden" }
{ "localidade" : "Bronx", "gastronomia" : "Chinese", "nome" : "Happy Garden" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Manhem Club" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "The New Starling Athletic Club Of The Bronx" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Yankee Tavern" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "The Punch Bowl" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Munchtime" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Marina Delray" }
{ "localidade" : "Bronx", "gastronomia" : "American", "nome" : "Cool Zone" } -->

<!-- 12. Liste o restaurant_id, o nome, a localidade e a gastronomia dos restaurantes localizados em "Staten Island", "Queens", ou "Brooklyn". -->
db.restaurants.find( { $or: [ { localidade: "Staten Island"}, { localidade: "Queens" }, { localidade: "Brooklyn" } ] }, { restaurant_id: 1, nome: 1, localidade: 1, gastronomia: 1, _id: 0 } )
<!-- { "localidade" : "Queens", "gastronomia" : "Jewish/Kosher", "nome" : "Tov Kosher Kitchen", "restaurant_id" : "40356068" }
{ "localidade" : "Brooklyn", "gastronomia" : "American", "nome" : "Riviera Caterer", "restaurant_id" : "40356018" }
{ "localidade" : "Staten Island", "gastronomia" : "Jewish/Kosher", "nome" : "Kosher Island", "restaurant_id" : "40356442" }
{ "localidade" : "Brooklyn", "gastronomia" : "Delicatessen", "nome" : "Wilken'S Fine Food", "restaurant_id" : "40356483" }
{ "localidade" : "Brooklyn", "gastronomia" : "Ice Cream, Gelato, Yogurt, Ices", "nome" : "Taste The Tropics Ice Cream", "restaurant_id" : "40356731" }
{ "localidade" : "Brooklyn", "gastronomia" : "American", "nome" : "C & C Catering Service", "restaurant_id" : "40357437" }
{ "localidade" : "Brooklyn", "gastronomia" : "American", "nome" : "Regina Caterers", "restaurant_id" : "40356649" }
{ "localidade" : "Brooklyn", "gastronomia" : "Chinese", "nome" : "May May Kitchen", "restaurant_id" : "40358429" }
{ "localidade" : "Brooklyn", "gastronomia" : "Jewish/Kosher", "nome" : "Seuda Foods", "restaurant_id" : "40360045" }
{ "localidade" : "Brooklyn", "gastronomia" : "Ice Cream, Gelato, Yogurt, Ices", "nome" : "Carvel Ice Cream", "restaurant_id" : "40360076" }
{ "localidade" : "Queens", "gastronomia" : "Ice Cream, Gelato, Yogurt, Ices", "nome" : "Carvel Ice Cream", "restaurant_id" : "40361322" } -->


<!-- 13. Liste o nome, a localidade, o score e gastronomia dos restaurantes que alcançaram sempre pontuações inferiores ou igual a 3. -->
db.restaurants.find( { "grades.score": { $not: { $gt: 3 } } } , { nome: 1, localidade: 1, grades: 1, gastronomia: 1 } )

<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786485"), "localidade" : "Brooklyn", "gastronomia" : "Hamburgers", "grades" : [ { "date" : ISODate("2014-11-14T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2013-10-21T00:00:00Z"), "grade" : "A", "score" : 3 }, { "date" : ISODate("2012-11-14T00:00:00Z"), "grade" : "A", "score" : 0 } ], "nome" : "White Castle" }
{ "_id" : ObjectId("617a6daa7f1fdb92797867b4"), "localidade" : "Manhattan", "gastronomia" : "Café/Coffee/Tea", "grades" : [ { "date" : ISODate("2014-09-09T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2013-09-20T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2012-09-20T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2011-10-04T00:00:00Z"), "grade" : "A", "score" : 2 } ], "nome" : "Cafe Madison" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786ab8"), "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-02-25T00:00:00Z"), "grade" : "A", "score" : 0 }, { "date" : ISODate("2013-01-14T00:00:00Z"), "grade" : "A", "score" : 3 }, { "date" : ISODate("2012-01-23T00:00:00Z"), "grade" : "A", "score" : 2 } ], "nome" : "Citibank Executive Conference Center" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786bca"), "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-03-14T00:00:00Z"), "grade" : "A", "score" : 3 }, { "date" : ISODate("2013-02-27T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2012-09-21T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2011-10-04T00:00:00Z"), "grade" : "A", "score" : 0 } ], "nome" : "Kenyon & Kenyon Cafeteria" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786ca2"), "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2013-11-14T00:00:00Z"), "grade" : "A", "score" : 2 }, { "date" : ISODate("2011-03-21T00:00:00Z"), "grade" : "A", "score" : 0 } ], "nome" : "Gold Bar B" }
{ "_id" : ObjectId("617a6dab7f1fdb9279786df0"), "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-07-15T00:00:00Z"), "grade" : "A", "score" : 0 }, { "date" : ISODate("2013-07-17T00:00:00Z"), "grade" : "A", "score" : 0 }, { "date" : ISODate("2011-10-25T00:00:00Z"), "grade" : "A", "score" : 2 } ], "nome" : "Circle In The Square Theatre" }
{ "_id" : ObjectId("617a6dab7f1fdb9279786f3e"), "localidade" : "Brooklyn", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-06-14T00:00:00Z"), "grade" : "A", "score" : 3 } ], "nome" : "Stand # 210" } -->

<!-- 14. Liste o nome e as avaliações dos restaurantes que obtiveram uma avaliação com um grade "A", um score 10 na data "2014-08-11T00: 00: 00Z" (ISODATE). -->
db.restaurants.find( { grades: { $elemMatch: { grade: "A", score: { $eq: 10 }, date: ISODate("2014-08-11T00:00:00Z") } } }, { nome: 1, grades: 1 } )
<!-- { "_id" : ObjectId("617a6daa7f1fdb9279786257"), "grades" : [ { "date" : ISODate("2014-08-11T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2014-03-14T00:00:00Z"), "grade" : "A", "score" : 3 }, { "date" : ISODate("2013-01-16T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2012-07-12T00:00:00Z"), "grade" : "A", "score" : 9 } ], "nome" : "Serendipity 3" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786760"), "grades" : [ { "date" : ISODate("2014-08-11T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2013-08-30T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2012-08-31T00:00:00Z"), "grade" : "A", "score" : 4 }, { "date" : ISODate("2012-04-13T00:00:00Z"), "grade" : "A", "score" : 9 } ], "nome" : "Mutual Of America" }
{ "_id" : ObjectId("617a6daa7f1fdb92797869df"), "grades" : [ { "date" : ISODate("2014-08-11T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2014-01-27T00:00:00Z"), "grade" : "B", "score" : 22 }, { "date" : ISODate("2013-06-26T00:00:00Z"), "grade" : "C", "score" : 37 }, { "date" : ISODate("2012-09-05T00:00:00Z"), "grade" : "C", "score" : 29 }, { "date" : ISODate("2012-04-16T00:00:00Z"), "grade" : "C", "score" : 33 } ], "nome" : "Udon West" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786acc"), "grades" : [ { "date" : ISODate("2015-01-05T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2014-08-11T00:00:00Z"), "grade" : "A", "score" : 10 }, { "date" : ISODate("2014-03-04T00:00:00Z"), "grade" : "B", "score" : 22 }, { "date" : ISODate("2013-09-13T00:00:00Z"), "grade" : "A", "score" : 5 }, { "date" : ISODate("2013-01-16T00:00:00Z"), "grade" : "A", "score" : 11 } ], "nome" : "Gene'S Coffee Shop" } -->

<!-- 15. Liste o restaurant_id, o nome e os score dos restaurantes nos quais a segunda avaliação foi grade "A" e ocorreu em ISODATE "2014-08-11T00: 00: 00Z". -->
db.restaurants.find( { $and: [ { "grades.1.grade": "A" }, { "grades.1.date": ISODate("2014-08-11T00:00:00Z") } ] }, { restaurant_id: 1, nome: 1, "grades.score": 1} )
<!-- { "_id" : ObjectId("617a6daa7f1fdb927978682f"), "grades" : [ { "score" : 10 }, { "score" : 9 }, { "score" : 13 }, { "score" : 10 }, { "score" : 11 } ], "nome" : "Club Macanudo (Cigar Bar)", "restaurant_id" : "40526406" }
{ "_id" : ObjectId("617a6daa7f1fdb9279786acc"), "grades" : [ { "score" : 9 }, { "score" : 10 }, { "score" : 22 }, { "score" : 5 }, { "score" : 11 } ], "nome" : "Gene'S Coffee Shop", "restaurant_id" : "40614916" } -->

<!-- 16. Liste o restaurant_id, o nome, o endereço (address) e as coordenadas geográficas
(coord) dos restaurantes onde o 2º elemento da matriz de coordenadas tem um
valor superior a 42 e inferior ou igual a 52. -->
db.restaurants.find( { "address.coord.1": { $gt: 42, $lte: 52 } }, { restaurant_id: 1, nome: 1, address: 1, _id: 0 } )
<!-- { "address" : { "building" : "47", "coord" : [ -78.877224, 42.89546199999999 ], "rua" : "Broadway @ Trinity Pl", "zipcode" : "10006" }, "nome" : "T.G.I. Friday'S", "restaurant_id" : "40387990" }
{ "address" : { "building" : "1", "coord" : [ -0.7119979, 51.6514664 ], "rua" : "Pennplaza E, Penn Sta", "zipcode" : "10001" }, "nome" : "T.G.I. Fridays", "restaurant_id" : "40388936" }
{ "address" : { "building" : "3000", "coord" : [ -87.86567699999999, 42.61150920000001 ], "rua" : "47 Avenue", "zipcode" : "11101" }, "nome" : "Di Luvio'S Deli", "restaurant_id" : "40402284" }
{ "address" : { "building" : "21972199", "coord" : [ -78.589606, 42.8912372 ], "rua" : "Broadway", "zipcode" : "10024" }, "nome" : "La Caridad 78", "restaurant_id" : "40568285" }
{ "address" : { "building" : "7981", "coord" : [ -84.9751215, 45.4713351 ], "rua" : "Hoyt Street", "zipcode" : "11201" }, "nome" : "Bijan'S", "restaurant_id" : "40876618" }
{ "address" : { "building" : "0", "coord" : [ -88.0778799, 42.4154769 ], "rua" : "& Grand Central", "zipcode" : "10017" }, "nome" : "Hyatt, Ny Central/Room Service", "restaurant_id" : "40879243" }
{ "address" : { "building" : "60", "coord" : [ -111.9975205, 42.0970258 ], "rua" : "West Side Highway", "zipcode" : "10006" }, "nome" : "Sports Center At Chelsea Piers (Sushi Bar)", "restaurant_id" : "40882356" } -->

<!-- 17. Liste nome, gastronomia e localidade de todos os restaurantes ordenando por ordem
crescente da gastronomia e, em segundo, por ordem decrescente de localidade. -->
db.restaurants.find( {},  { nome: 1, gastronomia: 1, localidade: 1, _id: 0 } ).sort( { gastronomia: 1, localidade: -1 } )
<!-- { "localidade" : "Manhattan", "gastronomia" : "Afghan", "nome" : "Afghan Kebab House" }
{ "localidade" : "Manhattan", "gastronomia" : "Afghan", "nome" : "Khyber Pass" }
{ "localidade" : "Manhattan", "gastronomia" : "Afghan", "nome" : "Afghan Kebab House #1" }
{ "localidade" : "Manhattan", "gastronomia" : "Afghan", "nome" : "Ariana Kebab House" }
{ "localidade" : "Queens", "gastronomia" : "African", "nome" : "Africana Restaurant" }
{ "localidade" : "Brooklyn", "gastronomia" : "African", "nome" : "Madiba" }
{ "localidade" : "Bronx", "gastronomia" : "African", "nome" : "African Terrace" }
{ "localidade" : "Bronx", "gastronomia" : "African", "nome" : "Ebe Ye Yie African Restaurant" }
{ "localidade" : "Staten Island", "gastronomia" : "American", "nome" : "Great Kills Yacht Club" }
{ "localidade" : "Staten Island", "gastronomia" : "American", "nome" : "South Shore Swimming Club" }
{ "localidade" : "Staten Island", "gastronomia" : "American", "nome" : "Labetti'S Post # 2159" }
{ "localidade" : "Staten Island", "gastronomia" : "American", "nome" : "Joyce'S Tavern" } -->


<!-- 18. Liste nome, localidade, grade e gastronomia de todos os restaurantes localizados em Brooklyn que não incluem gastronomia "American" 
e obtiveram uma classificação (grade) "A". Deve apresentá-los por ordem decrescente de gastronomia. -->
<!-- Note: Latin (Cuban, Dominican, Puerto Rican, South & Central American) não deve ser listado -->
db.restaurants.find( { $and: [ { localidade: "Brooklyn" }, { gastronomia: { $not: { $regex: /.*American.*/ } } }, { "grades.grade": "A" } ] }, { nome: 1, localidade: 1, grades: { grade: 1 }, gastronomia: 1, _id: 0 } )
<!-- { "localidade" : "Brooklyn", "gastronomia" : "Delicatessen", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Wilken'S Fine Food" }
{ "localidade" : "Brooklyn", "gastronomia" : "Ice Cream, Gelato, Yogurt, Ices", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Taste The Tropics Ice Cream" }
{ "localidade" : "Brooklyn", "gastronomia" : "Chinese", "grades" : [ { "grade" : "B" }, { "grade" : "A" }, { "grade" : "C" }, { "grade" : "B" }, { "grade" : "B" } ], "nome" : "May May Kitchen" }
{ "localidade" : "Brooklyn", "gastronomia" : "Jewish/Kosher", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "B" } ], "nome" : "Seuda Foods" }
{ "localidade" : "Brooklyn", "gastronomia" : "Ice Cream, Gelato, Yogurt, Ices", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "P" }, { "grade" : "A" } ], "nome" : "Carvel Ice Cream" }
{ "localidade" : "Brooklyn", "gastronomia" : "Hamburgers", "grades" : [ { "grade" : "A" }, { "grade" : "B" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Wendy'S" }
{ "localidade" : "Brooklyn", "gastronomia" : "Delicatessen", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Nordic Delicacies" }
{ "localidade" : "Brooklyn", "gastronomia" : "Hamburgers", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "White Castle" }
{ "localidade" : "Brooklyn", "gastronomia" : "Caribbean", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Shashemene Int'L Restaura" } -->

<!-- Check if regex is working properly:
db.restaurants.find( { $and: [ { localidade: "Brooklyn" }, { gastronomia: { $regex: /.*American.*/ } }, { "grades.grade": "A" } ] }, { nome: 1, localidade: 1, grades: { grade: 1 }, gastronomia: 1, _id: 0 } )
{ "localidade" : "Brooklyn", "gastronomia" : "American", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Bay Ridge Manor Catering" }
{ "localidade" : "Brooklyn", "gastronomia" : "Latin (Cuban, Dominican, Puerto Rican, South & Central American)", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Collado Restaurant" }
{ "localidade" : "Brooklyn", "gastronomia" : "American", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "B" } ], "nome" : "Bergen Beach Cafe" }
{ "localidade" : "Brooklyn", "gastronomia" : "American", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "Metrostar Cafe" }
{ "localidade" : "Brooklyn", "gastronomia" : "American", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" } ], "nome" : "J.J. Bubbles" } -->

<!-- 19. Conte o total de restaurante existentes em cada localidade. -->
db.restaurants.aggregate( { $group: { _id: "$localidade", count: { $sum: 1 } } } )
<!-- { "_id" : "Staten Island", "count" : 158 }
{ "_id" : "Queens", "count" : 738 }
{ "_id" : "Brooklyn", "count" : 684 }
{ "_id" : "Bronx", "count" : 309 }
{ "_id" : "Manhattan", "count" : 1883 } -->

<!-- 20. Liste todos os restaurantes cuja média dos score é superior a 30. -->
db.restaurants.aggregate( [ 
    { $unwind: "$grades" }, 
    { $group: { _id: { restaurant_id: "$restaurant_id"}, avgScore: { $avg: "$grades.score" } } },
    { $match: { avgScore: { $gt: 30 } } } 
] )
<!-- { "_id" : { "restaurant_id" : "40366157" }, "avgScore" : 32.142857142857146 }
{ "_id" : { "restaurant_id" : "40825993" }, "avgScore" : 30.8 }
{ "_id" : { "restaurant_id" : "40387237" }, "avgScore" : 32.6 }
{ "_id" : { "restaurant_id" : "40393488" }, "avgScore" : 38.6 }
{ "_id" : { "restaurant_id" : "40374268" }, "avgScore" : 30.8 }
{ "_id" : { "restaurant_id" : "40372466" }, "avgScore" : 33.666666666666664 }
{ "_id" : { "restaurant_id" : "40624470" }, "avgScore" : 30.6 }
{ "_id" : { "restaurant_id" : "40756344" }, "avgScore" : 36 } -->

<!-- 21. Indique os restaurantes que têm gastronomia "Portuguese", o somatório de score é superior a 50 e estão numa latitude inferior a -60. -->
db.restaurants.aggregate( [ 
    { $unwind: "$grades" }, 
    { $group: { _id: { restaurant_id: "$restaurant_id", gastronomia: "$gastronomia", coord: "$address.coord" }, scoreCount: { $sum: "$grades.score" } } },
    { $match: { $and: [ 
        { scoreCount: { $gt: 50 } }, 
        { "_id.gastronomia": "Portuguese" },
        { "_id.coord.0": { $lt: -60 } } ] 
    } } 
] )

<!-- { "_id" : { "restaurant_id" : "40535455", "gastronomia" : "Portuguese", "coord" : [ -74.0093371, 40.7258846 ] }, "scoreCount" : 80 }
{ "_id" : { "restaurant_id" : "40394518", "gastronomia" : "Portuguese", "coord" : [ -73.732315, 40.720725 ] }, "scoreCount" : 67 } -->

<!-- 22. Apresente o nome e o score dos 3 restaurantes com score médio mais elevado. -->
db.restaurants.aggregate( { $unwind: "$grades" },
    { $group: { _id: { nome: "$nome" }, avgScore: { $sum: "$grades.score" } } },
    { $sort : { avgScore: -1 } },
    { $limit : 3 }
)

<!-- { "_id" : { "nome" : "Mcdonald'S" }, "avgScore" : 3470 }
{ "_id" : { "nome" : "Starbucks Coffee" }, "avgScore" : 2861 }
{ "_id" : { "nome" : "Domino'S Pizza" }, "avgScore" : 1917 } -->

<!-- 23. Apresente o número de gastronomias diferentes na rua "Fifth Avenue". -->
db.restaurants.aggregate( [ { $match: { "address.rua": "Fifth Avenue" } },
    { $group: { _id: "$gastronomia" } }, 
    { $count: "nGastronomias" } ] )

<!-- { "nGastronomias" : 4 } -->

<!-- 24. Conte quantos restaurantes existem por rua e ordene por ordem decrescente. -->
db.restaurants.aggregate( [ { $group: { _id: "$address.rua", nRestaurants: { $sum: 1 } } }, 
    { $sort: { nRestaurants: -1 } } 
] )

<!-- { "_id" : "Broadway", "nRestaurants" : 178 }
{ "_id" : "3 Avenue", "nRestaurants" : 97 }
{ "_id" : "7 Avenue", "nRestaurants" : 71 }
{ "_id" : "2 Avenue", "nRestaurants" : 62 }
{ "_id" : "5 Avenue", "nRestaurants" : 52 }
{ "_id" : "Northern Boulevard", "nRestaurants" : 49 }
{ "_id" : "8 Avenue", "nRestaurants" : 48 }
{ "_id" : "Lexington Avenue", "nRestaurants" : 48 }
{ "_id" : "Amsterdam Avenue", "nRestaurants" : 46 }
{ "_id" : "1 Avenue", "nRestaurants" : 44 } -->


25. .. 30. Descreva 5 perguntas adicionais à base dados (alíneas 26 a 30) e apresente
igualmente a solução de pesquisa para cada questão.

<!-- 26. Apresente o tamanho do nome de cada localidade. -->

db.restaurants.aggregate([
    {
      $project: {
        "localidade": 1,
        "length": { $strLenCP: "$localidade" }
      }
    },
    { $group : { _id: { localidade: "$localidade", length: "$length"} } }
])

<!-- { "_id" : { "localidade" : "Staten Island", "length" : 13 } }
{ "_id" : { "localidade" : "Bronx", "length" : 5 } }
{ "_id" : { "localidade" : "Manhattan", "length" : 9 } }
{ "_id" : { "localidade" : "Porto", "length" : 5 } }
{ "_id" : { "localidade" : "Brooklyn", "length" : 8 } }
{ "_id" : { "localidade" : "Queens", "length" : 6 } } -->


<!-- 27. Apresente o restaurant_id e o score dos 5 restaurantes com score médio mais baixo. -->
db.restaurants.aggregate( { $unwind: "$grades" },
    { $group: { _id: { restaurant_id: "$restaurant_id" }, avgScore: { $sum: "$grades.score" } } },
    { $sort : { avgScore: 1 } },
    { $limit : 5 }
)

<!-- { "_id" : { "restaurant_id" : "40716961" }, "avgScore" : 2 }
{ "_id" : { "restaurant_id" : "40761262" }, "avgScore" : 2 }
{ "_id" : { "restaurant_id" : "40839319" }, "avgScore" : 3 }
{ "_id" : { "restaurant_id" : "40403946" }, "avgScore" : 4 }
{ "_id" : { "restaurant_id" : "40610155" }, "avgScore" : 5 } -->


<!-- 28. Liste nome, grade e gastronomia de todos os restaurantes que incluem gastronomia "African" 
e obtiveram uma classificação (grade) "B". --> 

db.restaurants.find( { $and: [ { gastronomia: { $regex: /.*African.*/ } }, { "grades.grade": "B" } ] }, { nome: 1, grades: { grade: 1 }, gastronomia: 1, _id: 0 } )

<!-- { "gastronomia" : "African", "grades" : [ { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "A" }, { "grade" : "B" } ], "nome" : "Africana Restaurant" } -->


<!-- 29. Indique os restaurantes com longitude superior a 40. -->
db.restaurants.find( { "address.coord.1": { $gt: 50 } } )

<!-- { "_id" : ObjectId("617a6daa7f1fdb92797864d2"), "address" : { "building" : "1", "coord" : [ -0.7119979, 51.6514664 ], "rua" : "Pennplaza E, Penn Sta", "zipcode" : "10001" }, "localidade" : "Manhattan", "gastronomia" : "American", "grades" : [ { "date" : ISODate("2014-07-01T00:00:00Z"), "grade" : "A", "score" : 7 }, { "date" : ISODate("2014-01-28T00:00:00Z"), "grade" : "A", "score" : 7 }, { "date" : ISODate("2013-01-14T00:00:00Z"), "grade" : "A", "score" : 9 }, { "date" : ISODate("2012-01-06T00:00:00Z"), "grade" : "A", "score" : 12 }, { "date" : ISODate("2011-09-07T00:00:00Z"), "grade" : "A", "score" : 5 } ], "nome" : "T.G.I. Fridays", "restaurant_id" : "40388936" } -->


<!-- 30. Apresente o número de gastronomias diferentes na localidade "Manhattan". -->

db.restaurants.aggregate( [ { $match: { "localidade": "Manhattan" } },
    { $group: { _id: "$gastronomia" } }, 
    { $count: "nGastronomias" } ] )

<!-- { "nGastronomias" : 61 } -->